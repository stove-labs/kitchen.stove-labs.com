(window.webpackJsonp=window.webpackJsonp||[]).push([[39],{136:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return s})),a.d(t,"metadata",(function(){return l})),a.d(t,"rightToc",(function(){return h})),a.d(t,"default",(function(){return b}));var n=a(2),o=a(6),r=(a(0),a(163)),i=a(216),c=a(217),s={id:"michelson",title:"Michelson"},l={id:"knowledge/smart_contract/michelson",isDocsHomePage:!1,title:"Michelson",description:"Michelson is the name of the smart contract language of Tezos. Broadly speaking, Michelson is to Tezos what the Ethereum Virtual Machine (EVM) is to Ethereum blockchain. It was specifically developed for Tezos and this article introduces you to the basics of the language and gives an outlook on its main differentiator: formal verification.",source:"@site/docs/knowledge/smart_contract/michelson.mdx",permalink:"/docs/knowledge/smart_contract/michelson",editUrl:"https://github.com/stove-labs/learn.stove-labs.com/edit/master/website/docs/knowledge/smart_contract/michelson.mdx",sidebar:"wiki",previous:{title:"Entrypoints",permalink:"/docs/knowledge/smart_contract/entrypoints"},next:{title:"Account",permalink:"/docs/knowledge/tezos_protocol/account"}},h=[{value:"Michelson language",id:"michelson-language",children:[{value:"Michelson code",id:"michelson-code",children:[]}]},{value:"High-level languages",id:"high-level-languages",children:[]},{value:"Formal verification",id:"formal-verification",children:[{value:"Examples of formal verification",id:"examples-of-formal-verification",children:[]}]}],p={rightToc:h};function b(e){var t=e.components,a=Object(o.a)(e,["components"]);return Object(r.b)("wrapper",Object(n.a)({},p,a,{components:t,mdxType:"MDXLayout"}),Object(r.b)("p",null,"Michelson is the name of the ",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"smart-contract"}),"smart contract")," language of Tezos. Broadly speaking, Michelson is to Tezos what the Ethereum Virtual Machine (EVM) is to Ethereum blockchain. It was specifically developed for Tezos and this article introduces you to the basics of the language and gives an outlook on its main differentiator: ",Object(r.b)("em",{parentName:"p"},"formal verification"),"."),Object(r.b)("h2",{id:"michelson-language"},"Michelson language"),Object(r.b)("blockquote",null,Object(r.b)("p",{parentName:"blockquote"},"The (Michelson) language is stack-based, with high level data types and primitives, and strict static type checking. ")),Object(r.b)("p",null,Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://tezos.gitlab.io/whitedoc/michelson.html"}),"Official documentation")),Object(r.b)("p",null,'As opposed to the EVM\'s "lower-level" bytecode, Michelson "higher-level" bytecode is human readable. With enough training you ',Object(r.b)("em",{parentName:"p"},"could")," verify yourself what comes out of the compiler and even write your own native Michelson code. Luckily this is not necessary in practice, because ",Object(r.b)("strong",{parentName:"p"},"high-level languages")," had been developed that resemble popular languages, such as Python, Reason, OCaml, that ",Object(r.b)("strong",{parentName:"p"},"compile down to Michelson"),". Nevertheless it is useful to understand the basic building blocks of Michelson code. "),Object(r.b)("h3",{id:"michelson-code"},"Michelson code"),Object(r.b)("p",null,"The following example is a simple Michelson smart contract that does the following: It takes a natural number as parameter and saves that number to its storage. "),Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{}),"{ parameter nat ;\n  storage nat ;\n  code { DUP ; CDR ; NIL operation ; PAIR ; DIP { DROP } } }\n")),Object(r.b)("p",null,"The contract itself has three parts:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("strong",{parentName:"li"},"parameter")," - This is the argument that is passed through a ",Object(r.b)("a",Object(n.a)({parentName:"li"},{href:"../tezos_protocol/operations/transaction"}),"transaction")," when ",Object(r.b)("em",{parentName:"li"},"invoking")," the contract."),Object(r.b)("li",{parentName:"ul"},Object(r.b)("strong",{parentName:"li"},"storage")," - The type definition of the storage."),Object(r.b)("li",{parentName:"ul"},Object(r.b)("strong",{parentName:"li"},"code")," - This is the actual smart contract code that takes as input the parameter and follows its code to manipulate the storage. ")),Object(r.b)("p",null,"The instructions DUP, CDR, PAIR DIP, DROP are collected into a sequence and applied to an intermediary state, called stack. This is applied at run-time to the storage, which represents a persistent state."),Object(r.b)("h2",{id:"high-level-languages"},"High-level languages"),Object(r.b)("p",null,"How does this piece of Michelson code look like in a high level language? We can show an example below in a language called ",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://www.ligolang.org"}),"Ligo"),'. It comes in three different language "flavors": PascalLigo, CamelLigo and ReasonLigo. '),Object(r.b)("p",null,"The code looks like this in ReasonLigo:"),Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-reason"}),"type parameter = nat;\ntype storage = nat;\n\nlet main = ((action, store): (parameter, storage)) : (list (operation), storage) =>\n  (([] : list (operation)), store);\n")),Object(r.b)("h2",{id:"formal-verification"},"Formal verification"),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Formal verification")," is a mathematical way to prove the correctness of source code with respect to a ",Object(r.b)("em",{parentName:"p"},"formal specification")," and allows a greater level of security for smart contracts written in Michelson. It is not a trivial process, because this approach does not check whether the code is 100% correct, but rather the behavior of the software against the specification. It typically requires expert knowledge to create that specification. Then a so called ",Object(r.b)("strong",{parentName:"p"},"interactive theorem prover"),", in the case of Tezos ",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://en.wikipedia.org/wiki/Coq"}),Object(r.b)("strong",{parentName:"a"},"Coq")),", is used for a ",Object(r.b)("strong",{parentName:"p"},"deductive verification"),". The outcome of this act is assurance that the source code behaves in the way according to the specification."),Object(r.b)("p",null,"This approach is used in industries, where there is little room for error, such as software used in aerospace or nuclear power generation. Similar to those industries, the same applies to blockchain technology, which has the potential to track and manage assets worth in the billions of USD. It is common for software used in finance to undergo expensive and lengthy source code audits. Formal verification plays a very big advantage in this process and is definitely a big differentiator for Tezos among other blockchain platforms. "),Object(r.b)("h3",{id:"examples-of-formal-verification"},"Examples of formal verification"),Object(r.b)("h4",{id:"the-managertz"},"The manager.tz"),Object(r.b)("p",null,"Our example is the ",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://gitlab.com/nomadic-labs/mi-cho-coq/blob/master/src/contracts/manager.tz"}),"manager script")," that is automatically added to originated ",Object(r.b)("inlineCode",{parentName:"p"},"KT1")," accounts. It is an essential piece of code, because it enables the owner of the smart contact, the implicit account that initiated the origination, to ",Object(r.b)("em",{parentName:"p"},"manage")," the smart contact. Consider someone sending \ua729 to the smart contract. We most definitely do not want to have it stuck there, in case it was sent there by mistake and there in no transfer functionality implemented. One of the features of ",Object(r.b)("inlineCode",{parentName:"p"},"manager.tz")," is to ",Object(r.b)("em",{parentName:"p"},"make the smart contract spendable"),". It exposes an ",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"entrypoints"}),"entypoint")," to send \ua729 to ",Object(r.b)("inlineCode",{parentName:"p"},"KT1")," or implicit ",Object(r.b)("inlineCode",{parentName:"p"},"tz")," ",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"../tezos_protocol/account"}),"accounts"),". Of course it checks for access control and makes sure that the source of the instruction (the transfer holding the parameters) is indeed the manager of the contract. "),Object(r.b)("h4",{id:"how-to-verify-in-practice"},"How to verify in practice"),Object(r.b)("p",null,"In practice, one has to ",Object(r.b)("strong",{parentName:"p"},"make sure")," that the ",Object(r.b)("strong",{parentName:"p"},"Michelson code")," that is deployed to the network ",Object(r.b)("strong",{parentName:"p"},"matches")," the contract that is defined at the ",Object(r.b)("strong",{parentName:"p"},"beginning of the specification"),". We have the example below of both the Michelson contract and the specification.  The specification itself was created using a framework called ",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://gitlab.com/nomadic-labs/mi-cho-coq"}),"Mi-Cho-Coq"),' that formalizes the Michelson language. It was written in OCaml and comes close to Michelson, but has slight differences in syntax. Notice the diffrence in curly braces and semicolons in the code below. Overall the specification has the formal semantics written using the "Coq Proof Assistant".',Object(r.b)("sup",Object(n.a)({parentName:"p"},{id:"fnref-1"}),Object(r.b)("a",Object(n.a)({parentName:"sup"},{href:"#fn-1",className:"footnote-ref"}),"1"))," With the help of the Mi-Cho-Coq framework the code is checked against the input and ouput defined in the rest of the specification. Following this procedure, ",Object(r.b)("strong",{parentName:"p"},"one gains certainty")," that the ",Object(r.b)("strong",{parentName:"p"},"code behaves according to the system specifications"),". "),Object(r.b)("p",null,"You can check the full ",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://gitlab.com/nomadic-labs/mi-cho-coq/blob/master/src/contracts_coq/manager.v"}),"manager.v")," specification and you will notice that it is multiple times longer than the contract itself. The repository holds specifications for various other contracts, such as multi-signature examples.",Object(r.b)("sup",Object(n.a)({parentName:"p"},{id:"fnref-2"}),Object(r.b)("a",Object(n.a)({parentName:"sup"},{href:"#fn-2",className:"footnote-ref"}),"2"))," "),Object(r.b)(i.a,{defaultValue:"michelson",values:[{label:"Michelson",value:"michelson"},{label:"Mi-Cho-Coq",value:"verification"}],mdxType:"Tabs"},Object(r.b)(c.a,{value:"michelson",mdxType:"TabItem"},Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-javascript",metastring:'title="manager.tz"',title:'"manager.tz"'}),"parameter\n  (or\n     (lambda %do unit (list operation))\n     (unit %default));\nstorage key_hash;\ncode\n  { UNPAIR ;\n    IF_LEFT\n      { # 'do' entrypoint\n        # Assert no token was sent:\n        # to send tokens, the default entry point should be used\n        PUSH mutez 0 ;\n        AMOUNT ;\n        ASSERT_CMPEQ ;\n        # Assert that the sender is the manager\n        DUUP ;\n        IMPLICIT_ACCOUNT ;\n        ADDRESS ;\n        SENDER ;\n        ASSERT_CMPEQ ;\n        # Execute the lambda argument\n        UNIT ;\n        EXEC ;\n        PAIR ;\n      }\n      { # 'default' entrypoint\n        DROP ;\n        NIL operation ;\n        PAIR ;\n      }\n  };\n"))),Object(r.b)(c.a,{value:"verification",mdxType:"TabItem"},Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-javascript",metastring:'title="manager.v L45-L70"',title:'"manager.v','L45-L70"':!0}),"Definition manager : full_contract _ ST.self_type storage_ty :=\n  (UNPAIR ;;\n   IF_LEFT\n   ( (* 'do' entrypoint *)\n     (* Assert no token was sent: *)\n     (* to send tokens, the default entry point should be used *)\n     PUSH mutez (0 ~mutez) ;;\n     AMOUNT ;;\n     ASSERT_CMPEQ ;;\n     (* Assert that the sender is the manager *)\n     DUUP ;;\n     IMPLICIT_ACCOUNT ;;\n     ADDRESS ;;\n     SENDER ;;\n     ASSERT_CMPEQ ;;\n     (* Execute the lambda argument *)\n     UNIT ;;\n     EXEC ;;\n     PAIR\n   )\n   ( (* 'default' entrypoint *)\n     DROP1 ;;\n     NIL operation ;;\n     PAIR\n   )\n  ).\n")))),Object(r.b)("div",{className:"footnotes"},Object(r.b)("hr",{parentName:"div"}),Object(r.b)("ol",{parentName:"div"},Object(r.b)("li",Object(n.a)({parentName:"ol"},{id:"fn-1"}),"The Coq development team ",Object(r.b)("a",Object(n.a)({parentName:"li"},{href:"http://coq.inria.fr"}),"http://coq.inria.fr"),Object(r.b)("a",Object(n.a)({parentName:"li"},{href:"#fnref-1",className:"footnote-backref"}),"\u21a9")),Object(r.b)("li",Object(n.a)({parentName:"ol"},{id:"fn-2"}),Object(r.b)("a",Object(n.a)({parentName:"li"},{href:"https://gitlab.com/nomadic-labs/mi-cho-coq/-/tree/master/src/contracts_coq"}),"Multiple contracts")," specified using ",Object(r.b)("em",{parentName:"li"},"Mi-Cho-Coq"),Object(r.b)("a",Object(n.a)({parentName:"li"},{href:"#fnref-2",className:"footnote-backref"}),"\u21a9")))))}b.isMDXComponent=!0},163:function(e,t,a){"use strict";a.d(t,"a",(function(){return p})),a.d(t,"b",(function(){return u}));var n=a(0),o=a.n(n);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function c(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,o=function(e,t){if(null==e)return{};var a,n,o={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var l=o.a.createContext({}),h=function(e){var t=o.a.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):c(c({},t),e)),a},p=function(e){var t=h(e.components);return o.a.createElement(l.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return o.a.createElement(o.a.Fragment,{},t)}},m=o.a.forwardRef((function(e,t){var a=e.components,n=e.mdxType,r=e.originalType,i=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),p=h(a),m=n,u=p["".concat(i,".").concat(m)]||p[m]||b[m]||r;return a?o.a.createElement(u,c(c({ref:t},l),{},{components:a})):o.a.createElement(u,c({ref:t},l))}));function u(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var r=a.length,i=new Array(r);i[0]=m;var c={};for(var s in t)hasOwnProperty.call(t,s)&&(c[s]=t[s]);c.originalType=e,c.mdxType="string"==typeof e?e:n,i[1]=c;for(var l=2;l<r;l++)i[l]=a[l];return o.a.createElement.apply(null,i)}return o.a.createElement.apply(null,a)}m.displayName="MDXCreateElement"},172:function(e,t,a){"use strict";function n(e){var t,a,o="";if("string"==typeof e||"number"==typeof e)o+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(a=n(e[t]))&&(o&&(o+=" "),o+=a);else for(t in e)e[t]&&(o&&(o+=" "),o+=t);return o}t.a=function(){for(var e,t,a=0,o="";a<arguments.length;)(e=arguments[a++])&&(t=n(e))&&(o&&(o+=" "),o+=t);return o}},186:function(e,t,a){"use strict";var n=a(0);const o=Object(n.createContext)({tabGroupChoices:{},setTabGroupChoices:()=>{},isAnnouncementBarClosed:!1,closeAnnouncementBar:()=>{}});t.a=o},187:function(e,t,a){"use strict";var n=a(0),o=a(186);t.a=function(){return Object(n.useContext)(o.a)}},216:function(e,t,a){"use strict";var n=a(0),o=a.n(n),r=a(187),i=a(172),c=a(92),s=a.n(c);const l=37,h=39;t.a=function(e){const{block:t,children:a,defaultValue:c,values:p,groupId:b}=e,{tabGroupChoices:m,setTabGroupChoices:u}=Object(r.a)(),[f,d]=Object(n.useState)(c);if(null!=b){const e=m[b];null!=e&&e!==f&&p.some(t=>t.value===e)&&d(e)}const g=e=>{d(e),null!=b&&u(b,e)},O=[];return o.a.createElement("div",null,o.a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:Object(i.a)("tabs",{"tabs--block":t})},p.map(({value:e,label:t})=>o.a.createElement("li",{role:"tab",tabIndex:"0","aria-selected":f===e,className:Object(i.a)("tabs__item",s.a.tabItem,{"tabs__item--active":f===e}),key:e,ref:e=>O.push(e),onKeyDown:e=>((e,t,a)=>{switch(a.keyCode){case h:((e,t)=>{const a=e.indexOf(t)+1;e[a]?e[a].focus():e[0].focus()})(e,t);break;case l:((e,t)=>{const a=e.indexOf(t)-1;e[a]?e[a].focus():e[e.length-1].focus()})(e,t)}})(O,e.target,e),onFocus:()=>g(e),onClick:()=>g(e)},t))),o.a.createElement("div",{role:"tabpanel",className:"margin-vert--md"},n.Children.toArray(a).filter(e=>e.props.value===f)[0]))}},217:function(e,t,a){"use strict";var n=a(0),o=a.n(n);t.a=function(e){return o.a.createElement("div",null,e.children)}}}]);